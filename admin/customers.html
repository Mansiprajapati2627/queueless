<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Management - Queueless Admin</title>
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <!-- Same sidebar as other pages -->
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <header class="main-header">
            <div class="header-left">
                <h1><i class="fas fa-users"></i> Customer Management</h1>
                <p>Manage customer profiles and loyalty programs</p>
            </div>
            <div class="header-right">
                <div class="customer-search">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchCustomers" placeholder="Search customers...">
                    </div>
                    <button class="btn-primary" onclick="exportCustomers()">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
            </div>
        </header>

        <!-- Customer Stats -->
        <div class="customer-stats">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-user-plus"></i>
                </div>
                <div class="stat-info">
                    <h3 id="totalCustomers">156</h3>
                    <p>Total Customers</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-star"></i>
                </div>
                <div class="stat-info">
                    <h3 id="activeCustomers">124</h3>
                    <p>Active Customers</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-undo"></i>
                </div>
                <div class="stat-info">
                    <h3 id="repeatRate">68%</h3>
                    <p>Repeat Rate</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-rupee-sign"></i>
                </div>
                <div class="stat-info">
                    <h3 id="avgSpending">₹1,240</h3>
                    <p>Avg Spending</p>
                </div>
            </div>
        </div>

        <!-- Customer Filters -->
        <div class="customer-filters">
            <div class="filter-group">
                <label>Filter by:</label>
                <select id="filterSegment" onchange="filterCustomers()">
                    <option value="all">All Customers</option>
                    <option value="new">New Customers</option>
                    <option value="regular">Regular Customers</option>
                    <option value="vip">VIP Customers</option>
                    <option value="inactive">Inactive</option>
                </select>
                
                <select id="filterSort" onchange="sortCustomers()">
                    <option value="recent">Most Recent</option>
                    <option value="spending">Highest Spending</option>
                    <option value="visits">Most Visits</option>
                    <option value="name">Name (A-Z)</option>
                </select>
                
                <input type="date" id="filterDate" onchange="filterByDate()" placeholder="Filter by date">
            </div>
        </div>

        <!-- Customers Table -->
        <div class="customers-table-container">
            <table class="customers-table">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" id="selectAll" onchange="selectAllCustomers()">
                        </th>
                        <th>Customer</th>
                        <th>Contact</th>
                        <th>Visits</th>
                        <th>Total Spent</th>
                        <th>Last Visit</th>
                        <th>Loyalty Points</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="customersTableBody">
                    <!-- Customers will be loaded here -->
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="pagination">
            <button class="page-btn" onclick="prevPage()">
                <i class="fas fa-chevron-left"></i>
            </button>
            <span class="page-info">Page <span id="currentPage">1</span> of <span id="totalPages">4</span></span>
            <button class="page-btn" onclick="nextPage()">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>

        <!-- Bulk Actions -->
        <div class="bulk-actions" id="bulkActions" style="display: none;">
            <span id="selectedCount">0 customers selected</span>
            <div class="action-buttons">
                <button class="btn-secondary" onclick="sendBulkEmail()">
                    <i class="fas fa-envelope"></i> Send Email
                </button>
                <button class="btn-secondary" onclick="sendBulkSMS()">
                    <i class="fas fa-sms"></i> Send SMS
                </button>
                <button class="btn-secondary" onclick="updateLoyaltyPoints()">
                    <i class="fas fa-star"></i> Update Points
                </button>
                <button class="btn-danger" onclick="deleteSelectedCustomers()">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        </div>

        <!-- Customer Details Modal -->
        <div id="customerModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="customerModalTitle">Customer Details</h2>
                    <span class="close" onclick="closeCustomerModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <div id="customerDetailsContent">
                        <!-- Customer details will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" onclick="closeCustomerModal()">Close</button>
                    <button class="btn-primary" onclick="editCustomer()">Edit Customer</button>
                </div>
            </div>
        </div>
    </div>

    <script src="admin.js"></script>
    <script>
        // Customers Management
        let customers = [];
        let currentPage = 1;
        const itemsPerPage = 10;
        let selectedCustomers = new Set();

        document.addEventListener('DOMContentLoaded', function() {
            loadCustomers();
            setupCustomerSearch();
        });

        function loadCustomers() {
            // Load sample customers data
            customers = JSON.parse(localStorage.getItem('queueless_customers') || '[]');
            
            if (customers.length === 0) {
                customers = getSampleCustomers();
                localStorage.setItem('queueless_customers', JSON.stringify(customers));
            }
            
            updateCustomerStats();
            renderCustomersTable();
        }

        function getSampleCustomers() {
            return [
                {
                    id: 1,
                    name: "Rahul Sharma",
                    email: "rahul@example.com",
                    phone: "+91 9876543210",
                    visits: 12,
                    totalSpent: 18500,
                    lastVisit: "2024-01-15",
                    loyaltyPoints: 1240,
                    status: "regular",
                    joinDate: "2023-06-15",
                    preferences: ["Vegetarian", "No Spice"],
                    favoriteItems: ["Paneer Tikka", "Garlic Naan"]
                },
                {
                    id: 2,
                    name: "Priya Patel",
                    email: "priya@example.com",
                    phone: "+91 9876543211",
                    visits: 8,
                    totalSpent: 12500,
                    lastVisit: "2024-01-14",
                    loyaltyPoints: 850,
                    status: "regular",
                    joinDate: "2023-08-20"
                },
                {
                    id: 3,
                    name: "Amit Kumar",
                    email: "amit@example.com",
                    phone: "+91 9876543212",
                    visits: 24,
                    totalSpent: 32500,
                    lastVisit: "2024-01-15",
                    loyaltyPoints: 2650,
                    status: "vip",
                    joinDate: "2023-03-10"
                },
                {
                    id: 4,
                    name: "Neha Singh",
                    email: "neha@example.com",
                    phone: "+91 9876543213",
                    visits: 3,
                    totalSpent: 4500,
                    lastVisit: "2024-01-10",
                    loyaltyPoints: 300,
                    status: "new",
                    joinDate: "2024-01-01"
                },
                {
                    id: 5,
                    name: "Vikram Mehta",
                    email: "vikram@example.com",
                    phone: "+91 9876543214",
                    visits: 18,
                    totalSpent: 28500,
                    lastVisit: "2024-01-13",
                    loyaltyPoints: 1980,
                    status: "vip",
                    joinDate: "2023-05-22"
                },
                {
                    id: 6,
                    name: "Sonia Gupta",
                    email: "sonia@example.com",
                    phone: "+91 9876543215",
                    visits: 6,
                    totalSpent: 8500,
                    lastVisit: "2023-12-28",
                    loyaltyPoints: 520,
                    status: "regular",
                    joinDate: "2023-09-15"
                },
                {
                    id: 7,
                    name: "Raj Malhotra",
                    email: "raj@example.com",
                    phone: "+91 9876543216",
                    visits: 32,
                    totalSpent: 42500,
                    lastVisit: "2024-01-14",
                    loyaltyPoints: 3520,
                    status: "vip",
                    joinDate: "2023-01-15"
                },
                {
                    id: 8,
                    name: "Anjali Reddy",
                    email: "anjali@example.com",
                    phone: "+91 9876543217",
                    visits: 4,
                    totalSpent: 6200,
                    lastVisit: "2024-01-12",
                    loyaltyPoints: 420,
                    status: "new",
                    joinDate: "2023-12-01"
                },
                {
                    id: 9,
                    name: "Deepak Joshi",
                    email: "deepak@example.com",
                    phone: "+91 9876543218",
                    visits: 15,
                    totalSpent: 21500,
                    lastVisit: "2024-01-11",
                    loyaltyPoints: 1580,
                    status: "regular",
                    joinDate: "2023-07-18"
                },
                {
                    id: 10,
                    name: "Maya Choudhary",
                    email: "maya@example.com",
                    phone: "+91 9876543219",
                    visits: 9,
                    totalSpent: 13500,
                    lastVisit: "2024-01-09",
                    loyaltyPoints: 920,
                    status: "regular",
                    joinDate: "2023-08-30"
                }
            ];
        }

        function updateCustomerStats() {
            const totalCustomers = customers.length;
            const activeCustomers = customers.filter(c => c.visits > 0).length;
            const repeatRate = Math.round((customers.filter(c => c.visits > 1).length / totalCustomers) * 100);
            const avgSpending = Math.round(customers.reduce((sum, c) => sum + c.totalSpent, 0) / totalCustomers);
            
            document.getElementById('totalCustomers').textContent = totalCustomers;
            document.getElementById('activeCustomers').textContent = activeCustomers;
            document.getElementById('repeatRate').textContent = `${repeatRate}%`;
            document.getElementById('avgSpending').textContent = `₹${avgSpending}`;
        }

        function renderCustomersTable(filteredCustomers = customers) {
            const tableBody = document.getElementById('customersTableBody');
            if (!tableBody) return;
            
            // Calculate pagination
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageCustomers = filteredCustomers.slice(startIndex, endIndex);
            const totalPages = Math.ceil(filteredCustomers.length / itemsPerPage);
            
            tableBody.innerHTML = '';
            
            pageCustomers.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <input type="checkbox" class="customer-checkbox" 
                               value="${customer.id}"
                               ${selectedCustomers.has(customer.id) ? 'checked' : ''}
                               onchange="toggleCustomerSelection(${customer.id})">
                    </td>
                    <td>
                        <div class="customer-cell">
                            <div class="customer-avatar">
                                ${customer.name.charAt(0)}
                            </div>
                            <div class="customer-info">
                                <strong>${customer.name}</strong>
                                <small>${customer.email}</small>
                            </div>
                        </div>
                    </td>
                    <td>${customer.phone}</td>
                    <td>${customer.visits}</td>
                    <td>₹${customer.totalSpent}</td>
                    <td>${formatDate(customer.lastVisit)}</td>
                    <td>
                        <span class="points-badge">${customer.loyaltyPoints} pts</span>
                    </td>
                    <td>
                        <span class="status-badge status-${customer.status}">
                            ${customer.status.toUpperCase()}
                        </span>
                    </td>
                    <td>
                        <div class="customer-actions">
                            <button class="btn-view" onclick="viewCustomer(${customer.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-edit" onclick="editCustomer(${customer.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-delete" onclick="deleteCustomer(${customer.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Update pagination info
            document.getElementById('currentPage').textContent = currentPage;
            document.getElementById('totalPages').textContent = totalPages;
            
            // Show/hide bulk actions
            updateBulkActions();
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-IN', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            });
        }

        function setupCustomerSearch() {
            const searchInput = document.getElementById('searchCustomers');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    const filtered = customers.filter(customer => 
                        customer.name.toLowerCase().includes(searchTerm) ||
                        customer.email.toLowerCase().includes(searchTerm) ||
                        customer.phone.includes(searchTerm)
                    );
                    currentPage = 1;
                    renderCustomersTable(filtered);
                });
            }
        }

        function filterCustomers() {
            const segment = document.getElementById('filterSegment').value;
            let filtered = customers;
            
            if (segment !== 'all') {
                filtered = customers.filter(customer => customer.status === segment);
            }
            
            currentPage = 1;
            renderCustomersTable(filtered);
        }

        function sortCustomers() {
            const sortBy = document.getElementById('filterSort').value;
            let sorted = [...customers];
            
            switch(sortBy) {
                case 'recent':
                    sorted.sort((a, b) => new Date(b.lastVisit) - new Date(a.lastVisit));
                    break;
                case 'spending':
                    sorted.sort((a, b) => b.totalSpent - a.totalSpent);
                    break;
                case 'visits':
                    sorted.sort((a, b) => b.visits - a.visits);
                    break;
                case 'name':
                    sorted.sort((a, b) => a.name.localeCompare(b.name));
                    break;
            }
            
            renderCustomersTable(sorted);
        }

        function filterByDate() {
            const date = document.getElementById('filterDate').value;
            if (!date) return;
            
            const filtered = customers.filter(customer => 
                customer.lastVisit >= date
            );
            
            currentPage = 1;
            renderCustomersTable(filtered);
        }

        function toggleCustomerSelection(customerId) {
            if (selectedCustomers.has(customerId)) {
                selectedCustomers.delete(customerId);
            } else {
                selectedCustomers.add(customerId);
            }
            
            updateBulkActions();
        }

        function selectAllCustomers() {
            const checkAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.customer-checkbox');
            
            if (checkAll.checked) {
                checkboxes.forEach(checkbox => {
                    const customerId = parseInt(checkbox.value);
                    selectedCustomers.add(customerId);
                    checkbox.checked = true;
                });
            } else {
                selectedCustomers.clear();
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
            }
            
            updateBulkActions();
        }

        function updateBulkActions() {
            const bulkActionsDiv = document.getElementById('bulkActions');
            const selectedCount = document.getElementById('selectedCount');
            
            if (selectedCustomers.size > 0) {
                bulkActionsDiv.style.display = 'flex';
                selectedCount.textContent = `${selectedCustomers.size} customers selected`;
            } else {
                bulkActionsDiv.style.display = 'none';
            }
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderCustomersTable();
            }
        }

        function nextPage() {
            const totalPages = Math.ceil(customers.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderCustomersTable();
            }
        }

        function viewCustomer(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (!customer) return;
            
            const modal = document.getElementById('customerModal');
            const content = document.getElementById('customerDetailsContent');
            
            content.innerHTML = `
                <div class="customer-profile">
                    <div class="profile-header">
                        <div class="profile-avatar">
                            ${customer.name.charAt(0)}
                        </div>
                        <div class="profile-info">
                            <h3>${customer.name}</h3>
                            <p class="customer-email">${customer.email}</p>
                            <span class="status-badge status-${customer.status}">
                                ${customer.status.toUpperCase()}
                            </span>
                        </div>
                    </div>
                    
                    <div class="profile-details">
                        <div class="detail-section">
                            <h4><i class="fas fa-info-circle"></i> Basic Information</h4>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <span class="detail-label">Phone:</span>
                                    <span class="detail-value">${customer.phone}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Join Date:</span>
                                    <span class="detail-value">${formatDate(customer.joinDate)}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Last Visit:</span>
                                    <span class="detail-value">${formatDate(customer.lastVisit)}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h4><i class="fas fa-chart-line"></i> Statistics</h4>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <span class="detail-label">Total Visits:</span>
                                    <span class="detail-value">${customer.visits}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Total Spent:</span>
                                    <span class="detail-value">₹${customer.totalSpent}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Avg Spending:</span>
                                    <span class="detail-value">₹${Math.round(customer.totalSpent / customer.visits)}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Loyalty Points:</span>
                                    <span class="detail-value">${customer.loyaltyPoints}</span>
                                </div>
                            </div>
                        </div>
                        
                        ${customer.preferences ? `
                        <div class="detail-section">
                            <h4><i class="fas fa-heart"></i> Preferences</h4>
                            <div class="preferences">
                                ${customer.preferences.map(pref => `<span class="preference-tag">${pref}</span>`).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                        ${customer.favoriteItems ? `
                        <div class="detail-section">
                            <h4><i class="fas fa-star"></i> Favorite Items</h4>
                            <div class="favorite-items">
                                ${customer.favoriteItems.map(item => `<span class="item-tag">${item}</span>`).join('')}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        function editCustomer(customerId) {
            if (customerId) {
                // Edit existing customer
                const customer = customers.find(c => c.id === customerId);
                if (customer) {
                    // Show edit form with customer data
                    alert(`Edit customer: ${customer.name}`);
                    // In real app, open edit modal with form
                }
            } else {
                // Add new customer
                alert('Add new customer feature coming soon!');
            }
        }

        function deleteCustomer(customerId) {
            if (confirm('Are you sure you want to delete this customer?')) {
                customers = customers.filter(c => c.id !== customerId);
                localStorage.setItem('queueless_customers', JSON.stringify(customers));
                loadCustomers();
                alert('Customer deleted successfully!');
            }
        }

        function sendBulkEmail() {
            const count = selectedCustomers.size;
            if (count === 0) return;
            
            alert(`Sending email to ${count} selected customers...`);
            // In real app, send actual emails
        }

        function sendBulkSMS() {
            const count = selectedCustomers.size;
            if (count === 0) return;
            
            alert(`Sending SMS to ${count} selected customers...`);
            // In real app, send actual SMS
        }

        function updateLoyaltyPoints() {
            const count = selectedCustomers.size;
            if (count === 0) return;
            
            const points = prompt(`Enter loyalty points to add for ${count} customers:`);
            if (points && !isNaN(points)) {
                customers.forEach(customer => {
                    if (selectedCustomers.has(customer.id)) {
                        customer.loyaltyPoints += parseInt(points);
                    }
                });
                
                localStorage.setItem('queueless_customers', JSON.stringify(customers));
                loadCustomers();
                alert(`${points} points added to ${count} customers!`);
            }
        }

        function deleteSelectedCustomers() {
            const count = selectedCustomers.size;
            if (count === 0) return;
            
            if (confirm(`Are you sure you want to delete ${count} customers?`)) {
                customers = customers.filter(c => !selectedCustomers.has(c.id));
                localStorage.setItem('queueless_customers', JSON.stringify(customers));
                selectedCustomers.clear();
                loadCustomers();
                alert(`${count} customers deleted successfully!`);
            }
        }

        function exportCustomers() {
            const csv = convertToCSV(customers);
            downloadCSV(csv, 'customers_export.csv');
            alert('Customers exported successfully!');
        }

        function convertToCSV(data) {
            const headers = ['Name', 'Email', 'Phone', 'Visits', 'Total Spent', 'Last Visit', 'Loyalty Points', 'Status'];
            const rows = data.map(customer => [
                customer.name,
                customer.email,
                customer.phone,
                customer.visits,
                customer.totalSpent,
                customer.lastVisit,
                customer.loyaltyPoints,
                customer.status
            ]);
            
            return [headers, ...rows].map(row => row.join(',')).join('\n');
        }

        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function closeCustomerModal() {
            document.getElementById('customerModal').style.display = 'none';
        }
    </script>
</body>
</html>